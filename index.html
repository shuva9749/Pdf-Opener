<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dropbox File Selector</title>

  <!-- Bootstrap CSS for design -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    .card-img-top {
      height: 200px;
      object-fit: cover;
      border-bottom: 1px solid #ddd;
    }
  </style>

  <!-- Dropbox Chooser Script -->
  <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="317alyycs84fbvu"></script>
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center mb-4">Dropbox File Selector</h1>
    <div class="text-center">
      <button id="dropboxChooser" class="btn btn-primary">Select Files from Dropbox</button>
    </div>
    <div class="row mt-4" id="fileDisplayArea"></div>
  </div>

  <script>
    document.getElementById("dropboxChooser").onclick = function () {
      Dropbox.choose({
        success: function (files) {
          const displayArea = document.getElementById("fileDisplayArea");
          displayArea.innerHTML = ""; // Clear old files
          files.forEach((file) => {
            const col = document.createElement("div");
            col.className = "col-md-4 mb-4";

            const card = document.createElement("div");
            card.className = "card";

            if (file.thumbnailLink || file.link) {
              const img = document.createElement("img");
              img.src = file.thumbnailLink || file.link;
              img.className = "card-img-top";
              img.alt = file.name;
              card.appendChild(img);
            }

            const cardBody = document.createElement("div");
            cardBody.className = "card-body";

            const title = document.createElement("h5");
            title.className = "card-title";
            title.textContent = file.name;

            const size = document.createElement("p");
            size.className = "card-text";
            size.innerHTML = `<strong>Size:</strong> ${(file.bytes / 1024).toFixed(2)} KB`;

            const downloadBtn = document.createElement("a");
            downloadBtn.className = "btn btn-success";
            downloadBtn.href = file.link;
            downloadBtn.download = file.name;
            downloadBtn.textContent = "Download";

            cardBody.appendChild(title);
            cardBody.appendChild(size);
            cardBody.appendChild(downloadBtn);
            card.appendChild(cardBody);
            col.appendChild(card);
            displayArea.appendChild(col);
          });
        },
        cancel: function () {
          console.log("User canceled the chooser.");
        },
        linkType: "direct", // or "preview"
        multiselect: true,
        extensions: ['.pdf', '.jpg', '.png']
      });
    };
  </script>
</body>
</html>
