<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dropbox File Selector</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Dropbox Chooser SDK -->
  <script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="317alyycs84fbvu"></script>

  <style>
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }
    .file-card img {
      height: 200px;
      object-fit: cover;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>

  <div class="container text-center">
    <h1 class="my-4">Dropbox File Selector</h1>
    <button id="dropbox-button" class="btn btn-primary mb-5">Select Files from Dropbox</button>

    <div id="file-preview" class="row justify-content-center"></div>
  </div>

  <script>
    // Handle success from Dropbox
    function handleDropboxSuccess(files) {
      const container = document.getElementById("file-preview");
      container.innerHTML = ""; // Clear previous files

      files.forEach((file) => {
        const col = document.createElement("div");
        col.className = "col-md-4 mb-4";

        const card = document.createElement("div");
        card.className = "card file-card";

        if (file.thumbnailLink || file.link) {
          const img = document.createElement("img");
          img.src = file.thumbnailLink || file.link;
          img.className = "card-img-top";
          img.alt = file.name;
          card.appendChild(img);
        }

        const body = document.createElement("div");
        body.className = "card-body";

        const title = document.createElement("h5");
        title.className = "card-title";
        title.textContent = file.name;

        const size = document.createElement("p");
        size.className = "card-text";
        size.innerHTML = `<strong>Size:</strong> ${(file.bytes / 1024).toFixed(2)} KB`;

        const downloadBtn = document.createElement("a");
        downloadBtn.className = "btn btn-success";
        downloadBtn.href = file.link;
        downloadBtn.download = file.name;
        downloadBtn.textContent = "Download";

        body.appendChild(title);
        body.appendChild(size);
        body.appendChild(downloadBtn);

        card.appendChild(body);
        col.appendChild(card);
        container.appendChild(col);
      });
    }

    // Trigger Dropbox Chooser
    document.getElementById("dropbox-button").addEventListener("click", function () {
      Dropbox.choose({
        success: handleDropboxSuccess,
        cancel: function () {
          console.log("User canceled Dropbox selection.");
        },
        linkType: "direct",
        multiselect: true,
        extensions: ['.pdf']
      });
    });
  </script>
</body>
</html>
