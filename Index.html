<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>File Picker</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client"></script>
  <script src="https://www.dropbox.com/static/api/2/dropins.js" data-app-key="317alyycs84fbvu" id="dropboxjs"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 30px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
    #output {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h2>File Picker</h2>

  <!-- Google Drive Picker -->
  <button onclick="handleAuthClick()">Pick from Google Drive</button>

  <!-- Dropbox Picker -->
  <button onclick="launchDropboxChooser()">Pick from Dropbox</button>

  <!-- My Device Picker -->
  <input type="file" id="localPicker" onchange="handleLocalFile(event)" />
  <label for="localPicker">
    <button>Select from My Device</button>
  </label>

  <div id="output"></div>

  <script>
    const CLIENT_ID = '705204588232-3m2bivi6c0nd41lgpe7j34abim8s0gta.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyAs1-yX51Kd5aKl-mB1oHhKXhOwCUDcPUY';
    const APP_ID = '705204588232';
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

    let tokenClient;
    let accessToken = null;

    function gapiLoaded() {
      gapi.load('client:picker', initializePicker);
    }

    async function initializePicker() {
      await gapi.client.load('https://www.googleapis.com/discovery/v1/apis/drive/v3/rest');
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (response) => {
          if (response.error !== undefined) throw response;
          accessToken = response.access_token;
          createPicker();
        },
      });
    }

    function handleAuthClick() {
      if (!accessToken) {
        tokenClient.requestAccessToken({ prompt: 'consent' });
      } else {
        createPicker();
      }
    }

    function createPicker() {
      const view = new google.picker.View(google.picker.ViewId.DOCS);
      view.setMimeTypes("application/pdf,image/png,image/jpeg");

      const picker = new google.picker.PickerBuilder()
        .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
        .setAppId(APP_ID)
        .setOAuthToken(accessToken)
        .setDeveloperKey(API_KEY)
        .addView(view)
        .setCallback(pickerCallback)
        .build();
      picker.setVisible(true);
    }

    function pickerCallback(data) {
      if (data.action == google.picker.Action.PICKED) {
        const output = document.getElementById('output');
        output.innerHTML = "<h3>Google Drive Files:</h3>";
        data.docs.forEach(file => {
          output.innerHTML += `<p>${file.name} (ID: ${file.id})</p>`;
        });
      }
    }

    function launchDropboxChooser() {
      Dropbox.choose({
        success: function(files) {
          const output = document.getElementById('output');
          output.innerHTML = "<h3>Dropbox Files:</h3>";
          files.forEach(file => {
            output.innerHTML += `<p><a href="${file.link}" target="_blank">${file.name}</a></p>`;
          });
        },
        linkType: "preview",
        multiselect: true,
        extensions: ['.pdf', '.jpg', '.png'],
      });
    }

    function handleLocalFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const output = document.getElementById('output');
      output.innerHTML = `<h3>My Device File:</h3><p>${file.name} (${file.type})</p>`;
    }

    // Load GAPI Picker
    gapiLoaded();
  </script>

</body>
</html>
